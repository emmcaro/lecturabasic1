<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Tutor - Lector de notes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ——— ESTILS IDENTICS A L'ANTERIOR VERSIÓ ——— */
        :root {
            --bg-color: #1a1a2e;
            --container-bg: #2c2f33;
            --primary-color: #bb86fc;
            --button-color: #E83F89;
            --text-color: #f0f0f0;
            --secondary-text-color: #a0a0a0;
            --correct-color: #4CAF50;
            --incorrect-color: #F44336;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }

        .container {
            background-color: var(--container-bg);
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            max-width: 90vw;
            width: 500px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin: 0;
            font-weight: 700;
        }

        .header-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--secondary-text-color);
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #difficulty-screen { display: flex; flex-direction: column; gap: 1.5rem; }
        #difficulty-buttons { display: flex; justify-content: center; flex-wrap: wrap; gap: 1rem; }

        .difficulty-button {
            background-color: var(--primary-color);
            color: var(--bg-color);
            border: none;
            padding: 0.75rem 1.25rem;
            font-size: 1rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }
        .difficulty-button:hover { background-color: #9b59b6; transform: translateY(-2px); }

        canvas {
            background-color: white;
            border: 2px solid var(--text-color);
            border-radius: 0.5rem;
            width: 100%;
            max-height: 250px;
        }

        .note-button {
            background-color: var(--button-color);
            color: var(--bg-color);
            border: none;
            padding: 0.75rem 1.25rem;
            font-size: 1.25rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 60px;
            font-weight: 600;
        }

        .note-button:hover { background-color: #c72b6b; transform: translateY(-2px); }
        #feedback-area { height: 2rem; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        #timer { font-weight: bold; color: var(--secondary-text-color); }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div id="difficulty-screen">
            <h1>Lectura de notes</h1>
            <div id="difficulty-buttons">
                <button class="difficulty-button" data-level="easy">Fàcil</button>
                <button class="difficulty-button" data-level="normal">Normal</button>
                <button class="difficulty-button" data-level="hard">Difícil</button>
                <button class="difficulty-button" data-level="expert">Expert ⚡</button>
            </div>
        </div>

        <div id="game-content" class="hidden">
            <div class="header-stats">
                <div>Punts: <span id="score">0</span> / <span id="totalQuestions">0</span></div>
                <div id="timer">Temps: 10s</div>
            </div>
            <canvas id="staffCanvas" width="500" height="250"></canvas>
            <div id="controls">
                <button class="note-button" data-note="C">do</button>
                <button class="note-button" data-note="D">re</button>
                <button class="note-button" data-note="E">mi</button>
                <button class="note-button" data-note="F">fa</button>
                <button class="note-button" data-note="G">sol</button>
                <button class="note-button" data-note="A">la</button>
                <button class="note-button" data-note="B">si</button>
            </div>
            <div id="feedback-area"></div>
            <button id="next-button" class="hidden">Següent</button>
        </div>

        <div id="final-score" class="hidden">
            <h2>Exercici completat!</h2>
            <p>Puntuació final: <span id="finalScoreDisplay"></span></p>
            <button class="play-again-button">Torna a jugar</button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('staffCanvas');
        const ctx = canvas.getContext('2d');
        const noteButtons = document.querySelectorAll('.note-button');
        const feedbackArea = document.getElementById('feedback-area');
        const scoreDisplay = document.getElementById('score');
        const totalQuestionsDisplay = document.getElementById('totalQuestions');
        const nextButton = document.getElementById('next-button');
        const difficultyButtons = document.querySelectorAll('.difficulty-button');
        const difficultyScreen = document.getElementById('difficulty-screen');
        const gameContent = document.getElementById('game-content');
        const finalScoreScreen = document.getElementById('final-score');
        const finalScoreDisplay = document.getElementById('finalScoreDisplay');
        const playAgainButton = document.querySelector('.play-again-button');
        const timerDisplay = document.getElementById('timer');

        // 🎧 Sons
        const soundWelcome = new Audio('sounds/benvinguda.mp3');
        const soundCorrect = new Audio('sounds/correcte.mp3');
        const soundError = new Audio('sounds/error.mp3');

        const lineHeight = 20;
        const staffTopY = 100;
        const MAX_QUESTIONS = 10;
        let score = 0, totalQuestions = 0, currentNote = null, currentNotes = {}, questionsPool = [];
        let timer = null, timeLeft = 10, timeLimit = 10, answered = false;

        const staffColor = '#333';
        const correctColor = getComputedStyle(document.documentElement).getPropertyValue('--correct-color');
        const incorrectColor = getComputedStyle(document.documentElement).getPropertyValue('--incorrect-color');

        const DIFFICULTY_NOTES = {
            easy: { 'C4': staffTopY + lineHeight * 5, 'D4': staffTopY + lineHeight * 4.5, 'E4': staffTopY + lineHeight * 4, 'F4': staffTopY + lineHeight * 3.5, 'G4': staffTopY + lineHeight * 3 },
            normal: { 'C4': staffTopY + lineHeight * 5, 'D4': staffTopY + lineHeight * 4.5, 'E4': staffTopY + lineHeight * 4, 'F4': staffTopY + lineHeight * 3.5, 'G4': staffTopY + lineHeight * 3, 'A4': staffTopY + lineHeight * 2.5, 'B4': staffTopY + lineHeight * 2, 'C5': staffTopY + lineHeight * 1.5 },
            hard: { 'A3': staffTopY + lineHeight * 6, 'B3': staffTopY + lineHeight * 5.5, 'C4': staffTopY + lineHeight * 5, 'D4': staffTopY + lineHeight * 4.5, 'E4': staffTopY + lineHeight * 4, 'F4': staffTopY + lineHeight * 3.5, 'G4': staffTopY + lineHeight * 3, 'A4': staffTopY + lineHeight * 2.5, 'B4': staffTopY + lineHeight * 2, 'C5': staffTopY + lineHeight * 1.5, 'D5': staffTopY + lineHeight * 1, 'E5': staffTopY + lineHeight * 0.5, 'F5': staffTopY, 'G5': staffTopY - lineHeight * 0.5, 'A5': staffTopY - lineHeight },
        };
        DIFFICULTY_NOTES.expert = { ...DIFFICULTY_NOTES.hard };

        function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
        function drawStaff(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.strokeStyle=staffColor;ctx.lineWidth=2;for(let i=0;i<5;i++){const y=staffTopY+i*lineHeight;ctx.beginPath();ctx.moveTo(30,y);ctx.lineTo(canvas.width-30,y);ctx.stroke();}ctx.font='170px Arial';ctx.fillStyle=staffColor;ctx.fillText('𝄞',40,staffTopY+lineHeight*4.7);}
        function drawNote(y){ctx.fillStyle=staffColor;ctx.beginPath();ctx.ellipse(canvas.width/2,y,15,12,-Math.PI/16,0,2*Math.PI);ctx.fill();ctx.strokeStyle=staffColor;ctx.lineWidth=2;ctx.beginPath();if(y>staffTopY+lineHeight*2){ctx.moveTo(canvas.width/2+15,y);ctx.lineTo(canvas.width/2+15,y-60);}else{ctx.moveTo(canvas.width/2-15,y);ctx.lineTo(canvas.width/2-15,y+60);}ctx.stroke();}
        
        function startTimer(){clearInterval(timer);timeLeft=timeLimit;timerDisplay.textContent=`Temps: ${timeLeft}s`;timer=setInterval(()=>{timeLeft--;timerDisplay.textContent=`Temps: ${timeLeft}s`;if(timeLeft<=0){clearInterval(timer);if(!answered){feedbackArea.textContent='Temps esgotat!';feedbackArea.style.color=incorrectColor;soundError.play();noteButtons.forEach(b=>b.disabled=true);nextButton.classList.remove('hidden');}}},1000);}
        
        function generateNewNote(){if(totalQuestions>=questionsPool.length)return endGame();drawStaff();answered=false;const noteName=questionsPool[totalQuestions];currentNote=noteName.charAt(0);drawNote(currentNotes[noteName]);feedbackArea.textContent='';nextButton.classList.add('hidden');noteButtons.forEach(b=>b.disabled=false);totalQuestions++;totalQuestionsDisplay.textContent=totalQuestions;startTimer();}
        
        function checkAnswer(sel){if(answered)return;answered=true;clearInterval(timer);if(sel===currentNote){score++;feedbackArea.textContent='Correcte!';feedbackArea.style.color=correctColor;soundCorrect.play();}else{feedbackArea.textContent=`Incorrecte! Era ${currentNote}`;feedbackArea.style.color=incorrectColor;soundError.play();}scoreDisplay.textContent=score;noteButtons.forEach(b=>b.disabled=true);nextButton.classList.remove('hidden');}

        function startGame(level){currentNotes=DIFFICULTY_NOTES[level];difficultyScreen.classList.add('hidden');gameContent.classList.remove('hidden');score=0;totalQuestions=0;scoreDisplay.textContent=score;totalQuestionsDisplay.textContent=totalQuestions;timeLimit=(level==='expert')?3:10;questionsPool=shuffle(Object.keys(currentNotes)).slice(0,10);soundWelcome.play();generateNewNote();}

        function endGame(){clearInterval(timer);gameContent.classList.add('hidden');finalScoreScreen.classList.remove('hidden');finalScoreDisplay.textContent=`${score}/${totalQuestions}`;}

        difficultyButtons.forEach(b=>b.addEventListener('click',()=>startGame(b.dataset.level)));
        noteButtons.forEach(b=>b.addEventListener('click',()=>checkAnswer(b.dataset.note)));
        nextButton.addEventListener('click',generateNewNote);
        playAgainButton.addEventListener('click',()=>{finalScoreScreen.classList.add('hidden');difficultyScreen.classList.remove('hidden');});
    });
    </script>
</body>
</html>

